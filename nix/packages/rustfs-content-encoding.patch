From 3d6c088e19afe0d45415c7c74621213653afe79c Mon Sep 17 00:00:00 2001
From: =?UTF-8?q?J=C3=B6rg=20Thalheim?= <joerg@thalheim.io>
Date: Tue, 9 Dec 2025 23:28:26 +0100
Subject: [PATCH] fix(get_object): Return Content-Encoding header in GetObject
 response
MIME-Version: 1.0
Content-Type: text/plain; charset=UTF-8
Content-Transfer-Encoding: 8bit

The Content-Encoding header was being stored in ObjectInfo but not
passed to GetObjectOutput. This caused clients expecting compressed
content (e.g., zstd-compressed narinfo files) to receive raw compressed
bytes without the Content-Encoding header, breaking decompression.

This is required for nix binary caches that upload narinfo files with
Content-Encoding: zstd compression.

Signed-off-by: JÃ¶rg Thalheim <joerg@thalheim.io>
---
 rustfs/src/storage/ecfs.rs | 1 +
 1 file changed, 1 insertion(+)

diff --git a/rustfs/src/storage/ecfs.rs b/rustfs/src/storage/ecfs.rs
index be4100b3..cb18ed11 100644
--- a/rustfs/src/storage/ecfs.rs
+++ b/rustfs/src/storage/ecfs.rs
@@ -2272,6 +2272,7 @@ impl S3 for FS {
             content_length: Some(response_content_length),
             last_modified,
             content_type,
+            content_encoding: info.content_encoding.clone(),
             accept_ranges: Some("bytes".to_string()),
             content_range,
             e_tag: info.etag.map(|etag| to_s3s_etag(&etag)),
-- 
2.51.2

